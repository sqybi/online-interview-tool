{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.compiled.js","sourcesContent":["'use strict';\n\n// '$' (jQuery), 'ace' and 'io' already imported\n// 'doc_id' and 'server_port' already defined\n\n\nlet updating = false;\nlet connected = false;\n\n\n/* Editor */\n\n// Code completion tool\nace.require('/ace/ext/language_tools')\n\n// Create editor\nconst editor = ace.edit('editor');\nconst editor_session = editor.getSession();\n\n// Editor settings\neditor.setFontSize(16);\neditor.$blockScrolling = Infinity;\neditor.setReadOnly(true);\n\n// Functionality\nasync function editor_start_sync() {\n    editor.setReadOnly(true);\n    updating = true;\n}\n\nasync function editor_stop_sync() {\n    updating = false;\n    editor.setReadOnly(false);\n}\n\nasync function editor_insert(event) {\n    const range = {\n        row: event.start.row,\n        column: event.start.column,\n    };\n    console.log(range, event.lines.join('\\n'));\n    await editor_session.insert(range, event.lines.join('\\n'));\n}\n\nasync function editor_remove(event) {\n    const range = {\n        start: {\n            row: event.start.row,\n            column: event.start.column,\n        },\n        end: {\n            row: event.end.row,\n            column: event.end.column,\n        },\n    }\n    console.log(range);\n    await editor_session.remove(range);\n}\n\n\n/* Options */\n\n// Highlight Language Selector\nconst highlight_selector = $('#editor-highlight');\nhighlight_selector.on('change', function () {\n    editor_session.setMode(highlight_selector.val());\n});\neditor_session.setMode(highlight_selector.val());\n\n// Theme Selector\nconst theme_selector = $('#editor-theme');\ntheme_selector.on('change', function () {\n    editor.setTheme(theme_selector.val());\n});\neditor.setTheme(theme_selector.val());\n\n// Keymap Selector\nconst keymap_selector = $('#editor-keymap');\nkeymap_selector.on('change', function () {\n    editor.setKeyboardHandler(keymap_selector.val());\n});\neditor.setKeyboardHandler(keymap_selector.val());\n\n/* Socket.IO */\n\n// Create socket\nconst socket = io(window.location.origin);\n\n// Connected\nsocket.on('connect', async function (data) {\n    socket.emit('join', {\n        doc_id: doc_id\n    });\n    $('#disconnected-alert').css('visibility', 'hidden');\n    connected = true;\n    editor.setReadOnly(false);\n});\n\n// Connection lost\nsocket.on('disconnect', async function (data) {\n    editor.setReadOnly(true);\n    connected = false;\n    $('#disconnected-alert').css('visibility', 'visible');\n});\n\n// Initialize document content\nsocket.on('refresh', async function (data) {\n    await editor_start_sync();\n    editor_session.setValue(data.content_text);\n    await editor_stop_sync();\n});\n\n// Document changed\neditor.on('change', async function (event) {\n    if (updating) {\n        return;\n    }\n    if (event.action == 'remove') {\n        event.lines = [];\n    }\n    socket.emit('apply', {\n        event: event,\n    });\n});\n\n// Other clients changed the document\nsocket.on('apply', async function (data) {\n    console.log(data.client_id, socket.id);\n    if (data.client_id == socket.id) {\n        return;\n    }\n    await editor_start_sync();\n    switch (data.event.action) {\n        case 'insert':\n            editor_insert(data.event);\n            break;\n        case 'remove':\n            editor_remove(data.event);\n            break;\n        default:\n            console.log('Undefined document operation: ' + operation.action);\n    }\n    await editor_stop_sync();\n});\n"]}