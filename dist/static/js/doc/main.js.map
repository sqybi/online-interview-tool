{"version":3,"sources":["../../../../static/js/doc/main.js"],"names":["editor","setReadOnly","updating","editor_start_sync","editor_stop_sync","event","range","row","start","column","console","log","lines","join","editor_session","insert","editor_insert","end","remove","editor_remove","connected","ace","require","edit","getSession","setFontSize","$blockScrolling","Infinity","setTabSize","setUseSoftTabs","setUseWrapMode","highlight_selector","$","on","setMode","val","theme_selector","setTheme","keymap_selector","setKeyboardHandler","socket","io","window","location","origin","data","emit","doc_id","css","height","find","html","setValue","content_text","action","client_id","id","operation"],"mappings":"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","file":"main.js","sourcesContent":["'use strict';\r\n\r\n// '$' (jQuery), 'ace' and 'io' already imported\r\n// 'doc_id' and 'server_port' already defined\r\n\r\n\r\nlet updating = false;\r\nlet connected = false;\r\n\r\n\r\n/* Editor */\r\n\r\n// Code completion tool\r\nace.require('/ace/ext/language_tools');\r\n\r\n// Create editor\r\nconst editor = ace.edit('editor');\r\nconst editor_session = editor.getSession();\r\n\r\n// Editor settings\r\neditor.setReadOnly(true);\r\neditor.setFontSize(16);\r\neditor.$blockScrolling = Infinity;\r\neditor_session.setTabSize(4);\r\neditor_session.setUseSoftTabs(true);\r\neditor_session.setUseWrapMode(true);\r\n\r\n// Functionality\r\nasync function editor_start_sync() {\r\n    editor.setReadOnly(true);\r\n    updating = true;\r\n}\r\n\r\nasync function editor_stop_sync() {\r\n    updating = false;\r\n    editor.setReadOnly(false);\r\n}\r\n\r\nasync function editor_insert(event) {\r\n    const range = {\r\n        row: event.start.row,\r\n        column: event.start.column,\r\n    };\r\n    console.log(range, event.lines.join('\\n'));\r\n    await editor_session.insert(range, event.lines.join('\\n'));\r\n}\r\n\r\nasync function editor_remove(event) {\r\n    const range = {\r\n        start: {\r\n            row: event.start.row,\r\n            column: event.start.column,\r\n        },\r\n        end: {\r\n            row: event.end.row,\r\n            column: event.end.column,\r\n        },\r\n    }\r\n    console.log(range);\r\n    await editor_session.remove(range);\r\n}\r\n\r\n\r\n/* Options */\r\n\r\n// Highlight Language Selector\r\nconst highlight_selector = $('#editor-highlight');\r\nhighlight_selector.on('change', function () {\r\n    editor_session.setMode(highlight_selector.val());\r\n});\r\neditor_session.setMode(highlight_selector.val());\r\n\r\n// Theme Selector\r\nconst theme_selector = $('#editor-theme');\r\ntheme_selector.on('change', function () {\r\n    editor.setTheme(theme_selector.val());\r\n});\r\neditor.setTheme(theme_selector.val());\r\n\r\n// Keymap Selector\r\nconst keymap_selector = $('#editor-keymap');\r\nkeymap_selector.on('change', function () {\r\n    editor.setKeyboardHandler(keymap_selector.val());\r\n});\r\neditor.setKeyboardHandler(keymap_selector.val());\r\n\r\n/* Socket.IO */\r\n\r\n// Create socket\r\nconst socket = io(window.location.origin);\r\n\r\n// Connected\r\nsocket.on('connect', async function (data) {\r\n    socket.emit('join', {\r\n        doc_id: doc_id\r\n    });\r\n    $('#disconnected-alert').css({'border-color':'#4390a3'}).height(0).find('span').html('CONNECTED').css({'color':'#4390a3'});\r\n    $('#disconnected-alert .unhappyface').css({'display':'none'});\r\n    $('#disconnected-alert .happyface').css({'display':'inline-block'});\r\n    connected = true;\r\n    editor.setReadOnly(false);\r\n});\r\n\r\n// Connection lost\r\nsocket.on('disconnect', async function (data) {\r\n    editor.setReadOnly(true);\r\n    connected = false;\r\n    $('#disconnected-alert').css({'border-color':'#dc5d55'}).height(20).find('span').html(\"DISCONNECTED\").css({'color':'#dc5d55'});\r\n    $('#disconnected-alert .unhappyface').css({'display':'inline-block'});\r\n    $('#disconnected-alert .happyface').css({'display':'none'});\r\n});\r\n\r\n// Initialize document content\r\nsocket.on('refresh', async function (data) {\r\n    await editor_start_sync();\r\n    editor_session.setValue(data.content_text);\r\n    await editor_stop_sync();\r\n});\r\n\r\n// Document changed\r\neditor.on('change', async function (event) {\r\n    if (updating) {\r\n        return;\r\n    }\r\n    if (event.action == 'remove') {\r\n        event.lines = [];\r\n    }\r\n    socket.emit('apply', {\r\n        event: event,\r\n    });\r\n});\r\n\r\n// Other clients changed the document\r\nsocket.on('apply', async function (data) {\r\n    console.log(data.client_id, socket.id);\r\n    if (data.client_id == socket.id) {\r\n        return;\r\n    }\r\n    await editor_start_sync();\r\n    switch (data.event.action) {\r\n        case 'insert':\r\n            editor_insert(data.event);\r\n            break;\r\n        case 'remove':\r\n            editor_remove(data.event);\r\n            break;\r\n        default:\r\n            console.log('Undefined document operation: ' + operation.action);\r\n    }\r\n    await editor_stop_sync();\r\n});\r\n"]}