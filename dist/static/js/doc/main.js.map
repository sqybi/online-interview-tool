{"version":3,"sources":["../../../../static/js/doc/main.js"],"names":["editor","setReadOnly","updating","editor_start_sync","editor_stop_sync","event","range","row","start","column","console","log","lines","join","editor_session","insert","editor_insert","end","remove","editor_remove","connected","ace","require","edit","getSession","setFontSize","$blockScrolling","Infinity","setTabSize","setUseSoftTabs","setUseWrapMode","highlight_selector","$","on","setMode","val","theme_selector","setTheme","keymap_selector","setKeyboardHandler","socket","io","window","location","origin","data","emit","doc_id","css","height","find","html","setValue","content_text","action","client_id","id","operation"],"mappings":"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","file":"main.js","sourcesContent":["'use strict';\n\n// '$' (jQuery), 'ace' and 'io' already imported\n// 'doc_id' and 'server_port' already defined\n\n\nlet updating = false;\nlet connected = false;\n\n\n/* Editor */\n\n// Code completion tool\nace.require('/ace/ext/language_tools');\n\n// Create editor\nconst editor = ace.edit('editor');\nconst editor_session = editor.getSession();\n\n// Editor settings\neditor.setReadOnly(true);\neditor.setFontSize(16);\neditor.$blockScrolling = Infinity;\neditor_session.setTabSize(4);\neditor_session.setUseSoftTabs(true);\neditor_session.setUseWrapMode(true);\n\n// Functionality\nasync function editor_start_sync() {\n    editor.setReadOnly(true);\n    updating = true;\n}\n\nasync function editor_stop_sync() {\n    updating = false;\n    editor.setReadOnly(false);\n}\n\nasync function editor_insert(event) {\n    const range = {\n        row: event.start.row,\n        column: event.start.column,\n    };\n    console.log(range, event.lines.join('\\n'));\n    await editor_session.insert(range, event.lines.join('\\n'));\n}\n\nasync function editor_remove(event) {\n    const range = {\n        start: {\n            row: event.start.row,\n            column: event.start.column,\n        },\n        end: {\n            row: event.end.row,\n            column: event.end.column,\n        },\n    }\n    console.log(range);\n    await editor_session.remove(range);\n}\n\n\n/* Options */\n\n// Highlight Language Selector\nconst highlight_selector = $('#editor-highlight');\nhighlight_selector.on('change', function () {\n    editor_session.setMode(highlight_selector.val());\n});\neditor_session.setMode(highlight_selector.val());\n\n// Theme Selector\nconst theme_selector = $('#editor-theme');\ntheme_selector.on('change', function () {\n    editor.setTheme(theme_selector.val());\n});\neditor.setTheme(theme_selector.val());\n\n// Keymap Selector\nconst keymap_selector = $('#editor-keymap');\nkeymap_selector.on('change', function () {\n    editor.setKeyboardHandler(keymap_selector.val());\n});\neditor.setKeyboardHandler(keymap_selector.val());\n\n/* Socket.IO */\n\n// Create socket\nconst socket = io(window.location.origin);\n\n// Connected\nsocket.on('connect', async function (data) {\n    socket.emit('join', {\n        doc_id: doc_id\n    });\n    $('#disconnected-alert').css({'border-color': '#4390a3'}).height(0).find('span').html('CONNECTED!').css({'color': '#4390a3'});\n    $('#disconnected-alert .unhappyface').css({'display': 'none'});\n    $('#disconnected-alert .happyface').css({'display': 'inline-block'});\n    connected = true;\n    editor.setReadOnly(false);\n});\n\n// Connection lost\nsocket.on('disconnect', async function (data) {\n    editor.setReadOnly(true);\n    connected = false;\n    $('#disconnected-alert').css({'border-color': '#dc5d55'}).height(20).find('span').html(\"DISCONNECTED!\").css({'color': '#dc5d55'});\n    $('#disconnected-alert .unhappyface').css({'display': 'inline-block'});\n    $('#disconnected-alert .happyface').css({'display': 'none'});\n});\n\n// Initialize document content\nsocket.on('refresh', async function (data) {\n    await editor_start_sync();\n    editor_session.setValue(data.content_text);\n    await editor_stop_sync();\n});\n\n// Document changed\neditor.on('change', async function (event) {\n    if (updating) {\n        return;\n    }\n    if (event.action == 'remove') {\n        event.lines = [];\n    }\n    socket.emit('apply', {\n        event: event,\n    });\n});\n\n// Other clients changed the document\nsocket.on('apply', async function (data) {\n    console.log(data.client_id, socket.id);\n    if (data.client_id == socket.id) {\n        return;\n    }\n    await editor_start_sync();\n    switch (data.event.action) {\n        case 'insert':\n            editor_insert(data.event);\n            break;\n        case 'remove':\n            editor_remove(data.event);\n            break;\n        default:\n            console.log('Undefined document operation: ' + operation.action);\n    }\n    await editor_stop_sync();\n});\n"]}